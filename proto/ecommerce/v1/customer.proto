syntax = "proto3";

package ecommerce.v1;

import "ecommerce/v1/common.proto";
import "google/protobuf/timestamp.proto";

service CustomerService {
  rpc ListCustomers(ListCustomersRequest) returns (ListCustomersResponse);
  rpc GetCustomer(GetCustomerRequest) returns (GetCustomerResponse);
  rpc CreateCustomer(CreateCustomerRequest) returns (CreateCustomerResponse);
  rpc UpdateCustomer(UpdateCustomerRequest) returns (UpdateCustomerResponse);
  rpc UpsertCustomerIdentity(UpsertCustomerIdentityRequest) returns (UpsertCustomerIdentityResponse);
  rpc UpsertCustomerAddress(UpsertCustomerAddressRequest) returns (UpsertCustomerAddressResponse);
  rpc ListCustomerMetafieldDefinitions(ListCustomerMetafieldDefinitionsRequest)
      returns (ListCustomerMetafieldDefinitionsResponse);
  rpc CreateCustomerMetafieldDefinition(CreateCustomerMetafieldDefinitionRequest)
      returns (CreateCustomerMetafieldDefinitionResponse);
  rpc UpdateCustomerMetafieldDefinition(UpdateCustomerMetafieldDefinitionRequest)
      returns (UpdateCustomerMetafieldDefinitionResponse);
  rpc ListCustomerMetafieldValues(ListCustomerMetafieldValuesRequest)
      returns (ListCustomerMetafieldValuesResponse);
  rpc UpsertCustomerMetafieldValue(UpsertCustomerMetafieldValueRequest)
      returns (UpsertCustomerMetafieldValueResponse);
}

message Customer {
  string id = 1;
  string tenant_id = 2;
  string status = 3;
  google.protobuf.Timestamp created_at = 4;
  google.protobuf.Timestamp updated_at = 5;
}

message CustomerProfile {
  string id = 1;
  string customer_id = 2;
  string store_id = 3;
  string name = 4;
  string email = 5;
  string phone = 6;
  string status = 7;
  string notes = 8;
  string country_code = 9;
  google.protobuf.Timestamp created_at = 10;
  google.protobuf.Timestamp updated_at = 11;
}

message CustomerIdentity {
  string id = 1;
  string customer_id = 2;
  string tenant_id = 3;
  string identity_type = 4; // email | phone | external
  string identity_value = 5;
  bool verified = 6;
  string source = 7; // signup | import | merge | admin
  google.protobuf.Timestamp created_at = 8;
}

message CustomerAddress {
  string id = 1;
  string customer_id = 2;
  string type = 3; // shipping | billing
  string name = 4;
  string postal_code = 5;
  string prefecture = 6;
  string city = 7;
  string line1 = 8;
  string line2 = 9;
  string phone = 10;
  string country_code = 11;
  google.protobuf.Timestamp created_at = 12;
  google.protobuf.Timestamp updated_at = 13;
}

message CustomerSummary {
  string customer_id = 1;
  string profile_id = 2;
  string store_id = 3;
  string name = 4;
  string email = 5;
  string phone = 6;
  string status = 7;
  google.protobuf.Timestamp created_at = 8;
}

message CustomerProfileInput {
  string name = 1;
  string email = 2;
  string phone = 3;
  string status = 4;
  string notes = 5;
  string country_code = 6;
}

message CustomerIdentityInput {
  string identity_type = 1;
  string identity_value = 2;
  bool verified = 3;
}

message CustomerIdentityUpsert {
  string id = 1;
  string identity_type = 2;
  string identity_value = 3;
  bool verified = 4;
  string source = 5;
}

message CustomerAddressInput {
  string id = 1;
  string type = 2;
  string name = 3;
  string postal_code = 4;
  string prefecture = 5;
  string city = 6;
  string line1 = 7;
  string line2 = 8;
  string phone = 9;
  string country_code = 10;
}

message MetafieldDefinition {
  string id = 1;
  string owner_type = 2;
  string namespace = 3;
  string key = 4;
  string name = 5;
  string description = 6;
  string value_type = 7;
  bool is_list = 8;
  string validations_json = 9;
  string visibility_json = 10;
  google.protobuf.Timestamp created_at = 11;
  google.protobuf.Timestamp updated_at = 12;
}

message MetafieldValue {
  string id = 1;
  string definition_id = 2;
  string owner_id = 3;
  string value_json = 4;
  google.protobuf.Timestamp created_at = 5;
  google.protobuf.Timestamp updated_at = 6;
  MetafieldDefinition definition = 7;
}

message ListCustomersRequest {
  StoreContext store = 1;
  TenantContext tenant = 2;
  string query = 3;
  PageInfo page = 4;
}

message ListCustomersResponse {
  repeated CustomerSummary customers = 1;
  PageResult page = 2;
}

message GetCustomerRequest {
  StoreContext store = 1;
  TenantContext tenant = 2;
  string customer_id = 3;
}

message GetCustomerResponse {
  Customer customer = 1;
  CustomerProfile profile = 2;
  repeated CustomerIdentity identities = 3;
  repeated CustomerAddress addresses = 4;
}

message CreateCustomerRequest {
  StoreContext store = 1;
  TenantContext tenant = 2;
  CustomerProfileInput profile = 3;
  repeated CustomerIdentityInput identities = 4;
  ActorContext actor = 5;
}

message CreateCustomerResponse {
  Customer customer = 1;
  CustomerProfile profile = 2;
  bool matched_existing = 3;
}

message UpdateCustomerRequest {
  StoreContext store = 1;
  TenantContext tenant = 2;
  string customer_id = 3;
  CustomerProfileInput profile = 4;
  string customer_status = 5;
  ActorContext actor = 6;
}

message UpdateCustomerResponse {
  Customer customer = 1;
  CustomerProfile profile = 2;
}

message UpsertCustomerIdentityRequest {
  StoreContext store = 1;
  TenantContext tenant = 2;
  string customer_id = 3;
  CustomerIdentityUpsert identity = 4;
  ActorContext actor = 5;
}

message UpsertCustomerIdentityResponse {
  CustomerIdentity identity = 1;
}

message UpsertCustomerAddressRequest {
  StoreContext store = 1;
  TenantContext tenant = 2;
  string customer_id = 3;
  CustomerAddressInput address = 4;
  ActorContext actor = 5;
}

message UpsertCustomerAddressResponse {
  CustomerAddress address = 1;
}

message ListCustomerMetafieldDefinitionsRequest {
  StoreContext store = 1;
  TenantContext tenant = 2;
}

message ListCustomerMetafieldDefinitionsResponse {
  repeated MetafieldDefinition definitions = 1;
}

message CustomerMetafieldDefinitionInput {
  string namespace = 1;
  string key = 2;
  string name = 3;
  string description = 4;
  string value_type = 5;
  bool is_list = 6;
  string validations_json = 7;
  string visibility_json = 8;
}

message CreateCustomerMetafieldDefinitionRequest {
  StoreContext store = 1;
  TenantContext tenant = 2;
  CustomerMetafieldDefinitionInput definition = 3;
  ActorContext actor = 4;
}

message CreateCustomerMetafieldDefinitionResponse {
  MetafieldDefinition definition = 1;
}

message UpdateCustomerMetafieldDefinitionRequest {
  StoreContext store = 1;
  TenantContext tenant = 2;
  string definition_id = 3;
  CustomerMetafieldDefinitionInput definition = 4;
  ActorContext actor = 5;
}

message UpdateCustomerMetafieldDefinitionResponse {
  MetafieldDefinition definition = 1;
}

message ListCustomerMetafieldValuesRequest {
  StoreContext store = 1;
  TenantContext tenant = 2;
  string customer_id = 3;
}

message ListCustomerMetafieldValuesResponse {
  repeated MetafieldValue values = 1;
}

message UpsertCustomerMetafieldValueRequest {
  StoreContext store = 1;
  TenantContext tenant = 2;
  string customer_id = 3;
  string definition_id = 4;
  string value_json = 5;
  ActorContext actor = 6;
}

message UpsertCustomerMetafieldValueResponse {
}
